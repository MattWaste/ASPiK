<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ASPiK SDK: Messaging Custom Objects</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">ASPiK SDK
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('cv9.html','');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Messaging Custom Objects </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>We implemented custom knob as an example of using the same lock-free ring buffer concept to move messages between the plugin core and the custom objects as opposed to moving audio data. Here we have set up a custom data structure that contains the messaging information - some basic stuff is there and you are encouraged to experiment with your own messaging and custom view work. In this example, we will pick up the knob's custom view interface pointer and use it to send a custom message to the object, which will acknowledge back (pretty cool, huh?).<br />
 <br />
 The custom message structure is shown below; in this example, we are only going to use the two std::strings, one to query the object and the other to access information it returns to us:<br />
 <br />
 <b>struct CustomViewMessage </b><br />
 {<br />
 &emsp;// &mdash; show/hide flag<br />
 &emsp;unsigned int message = MESSAGE_HIDE_CONTROL;<br />
 <br />
 &emsp;bool visible = true;<br />
 &emsp;bool showAlternateGraphic = false;<br />
 &emsp;double controlAlpha = 1.0; // transparency: 0 = invisible (100% transparent) and 1 = solidly visible (0% transparent)<br />
 &emsp;<b>std::string queryString;</b><br />
 &emsp;<b>std::string replyString;</b><br />
 &emsp;void* messageData = nullptr;<br />
 };<br />
 <br />
 In the <a class="el" href="class_plugin_core.html" title="The PluginCore object is the default PluginBase derived object for ASPiK projects. Note that you are fre to change the name of this object (as long as you change it in the compiler settings, etc...) ">PluginCore</a>, we'll communicate with the knob when the custom view is registered (only as an example - you can experiment with this all you like). The code for the PLUGINGUI_REGISTER_CUSTOMVIEW is shown here (it follows the registration code for the two custom audio viewer objects). Set a breakpoint in the debugger and run the plugin - when you open the GUI, you can check the communication and reply you get back by examining the return string. Notice also that we set up this object so that it copies it's "this" poitner into the messageData variable on the message data structure. Using this, you can (in theory) obtain a pointer to the underlying object itself, HOWEVER THIS IS NOT RECOMMENDED AS IT IS VERY DANGEROUS CODING.<br />
 <br />
 <b>if (messageInfo.inMessageString.compare("CustomKnobView") == 0) </b><br />
 {<br />
 &emsp;// &mdash; (1) get the custom view interface via incoming message data*<br />
 &emsp;<b>if (knobView != static_cast&lt;ICustomView*&gt;(messageInfo.inMessageData))</b><br />
 &emsp;&emsp;<b> knobView = static_cast&lt;ICustomView*&gt;(messageInfo.inMessageData);</b><br />
 <br />
 &emsp;if (!knobView) return false;<br />
 <br />
 &emsp;// &mdash; send the view a message<br />
 &emsp;<b>CustomViewMessage knobMessage;</b><br />
 &emsp;<b>knobMessage.message = MESSAGE_QUERY_CONTROL;</b><br />
 &emsp;<b>knobMessage.queryString.assign("Hello There!");</b><br />
 <br />
 &emsp;// &mdash; send the message<br />
 &emsp;<b>knobView-&gt;sendMessage(&amp;knobMessage);</b><br />
 <br />
 &emsp;// &mdash; check the reply string<br />
 &emsp;<b>const char* reply = knobMessage.replyString.c_str();</b><br />
 <br />
 &emsp;// &mdash; this will dequeue the object's ring buffer<br />
 &emsp;knobView-&gt;updateView();<br />
 <br />
 &emsp;// &mdash; DO NOT DO THIS!!! (but it is possible)<br />
 &emsp;//CAnimKnob* customKnob = static_cast&lt;CAnimKnob*&gt;(knobMessage.messageData);<br />
 <br />
 &emsp;// &mdash; registered!<br />
 &emsp;return true;<br />
 }<br />
 <br />
 The knob's ::sendMessage( ) function that decodes the query, fixes the reply, and (risky) copies its THIS pointer to the message structure is here:<br />
 <br />
 <b>void CustomKnobView::sendMessage(void* data)</b><br />
 {<br />
 &emsp;<b>CustomViewMessage* viewMessage = static_cast&lt;CustomViewMessage*&gt;(data);</b><br />
 &emsp;if (!viewMessage) return;<br />
</p>
<p>&emsp;if (viewMessage-&gt;message == MESSAGE_QUERY_CONTROL)<br />
 &emsp;{<br />
 &emsp;&emsp;<b>if (viewMessage-&gt;queryString.compare("Hello There!") == 0)</b><br />
 &emsp;&emsp;{<br />
 &emsp;&emsp;&emsp;<b>viewMessage-&gt;replyString.assign("I'm Here!!");</b><br />
 &emsp;&emsp;&emsp;<b>viewMessage-&gt;messageData = this; </b>// &lt;&ndash; example of VERY risky thing to do; not recommended<br />
 &emsp;&emsp;}<br />
 &emsp;&emsp;return; // do not process further<br />
 &emsp;}<br />
 <br />
 &emsp;// &mdash;&gt;&gt; CustomViewMessage has =operator<br />
 &emsp;<b>dataQueue-&gt;enqueue(*viewMessage);</b><br />
 }<br />
 <br />
 At the end of the function, the message is added to the local lock-free ring buffer queue for further processing (not needed here) and in the updateView() method the ring-buffer is emptied (note that we called it after getting the reply message in the previous function).<br />
 <br />
 </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="index.html">ASPiK Developer&#39;s Guide</a></li><li class="navelem"><a class="el" href="gui_design.html">Design a GUI</a></li><li class="navelem"><a class="el" href="define_g_u_i6.html">Advanced GUI Topics</a></li><li class="navelem"><a class="el" href="gui_designer11.html">Custom Views</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.14 </li>
  </ul>
</div>
</body>
</html>
