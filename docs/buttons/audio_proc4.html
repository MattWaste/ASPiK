<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ASPiK SDK: Parameter Smoothing</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">ASPiK SDK
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('audio_proc4.html','');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Parameter Smoothing </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><b>Parameter Smoothing OFF</b><br />
 When parameter smoothing is turned off, the parameter’s value will remain fixed and constant during the entire buffer processing cycle. This means that we are wasting CPU cycles by recalculating the cooked volume value on each audio frame. We really only need to calculate it once per buffer cycle and we can make use of the function <b><a class="el" href="class_plugin_core.html#ac9434dc2b1d2abe3b69357f48aa20513" title="perform any operations after the plugin parameter has been updated; this is one paradigm for transfer...">PluginCore::postUpdatePluginParameter</a></b> that will be called during the buffer pre-processing phase. Since this function is external to the <em>processAudioFrame</em> function, we will need to declare the cooked volume value as a member variable of the <a class="el" href="class_plugin_core.html" title="The PluginCore object is the default PluginBase derived object for ASPiK projects. Note that you are fre to change the name of this object (as long as you change it in the compiler settings, etc...) ">PluginCore</a> object in the <a class="el" href="plugincore_8h.html" title="base class interface file for ASPiK plugincore object ">plugincore.h</a> file:<br />
 <br />
 private:<br />
 &emsp;// &mdash; Continuous Plugin Variables<br />
 &emsp;<b>double volume_dB = 0.0;</b><br />
</p>
<p>&emsp;// &mdash; cooked volume value <a class="el" href="class_plugin_core.html#ac9434dc2b1d2abe3b69357f48aa20513" title="perform any operations after the plugin parameter has been updated; this is one paradigm for transfer...">PluginCore::postUpdatePluginParameter()</a><br />
 &emsp;<b>double volumeCooked = 0.0;</b><br />
</p>
<p>&emsp;// &mdash; Discrete Plugin Variables<br />
 &emsp;<b>int enableMute = 0;</b><br />
</p>
<p>&emsp;etc . . .<br />
 <br />
 Then, in <a class="el" href="class_plugin_core.html#ac9434dc2b1d2abe3b69357f48aa20513" title="perform any operations after the plugin parameter has been updated; this is one paradigm for transfer...">PluginCore::postUpdatePluginParameter</a> we will decode the parameter controlID, and cook the incoming raw data. Because of our clever controlID enumeration naming convention, we don’t need to look up the controlID, we simply use the enumeration which is the same as the variable name (controlID::volume_dB):<br />
 <br />
 <b>bool <a class="el" href="class_plugin_core.html#ac9434dc2b1d2abe3b69357f48aa20513" title="perform any operations after the plugin parameter has been updated; this is one paradigm for transfer...">PluginCore::postUpdatePluginParameter(int32_t controlID, double controlValue, ParameterUpdateInfo&amp; paramInfo)</a></b><br />
 {<br />
 &emsp;// &mdash; decode the controlID<br />
 &emsp;<b>switch(controlID)</b><br />
 &emsp;{<br />
 &emsp;&emsp;<b>case controlID::volume_dB:</b><br />
 &emsp;&emsp;{<br />
 &emsp;&emsp;&emsp;// &mdash; cooked variables<br />
 &emsp;&emsp;&emsp;<b>volumeCooked = pow(10.0, volume_dB / 20.0);</b><br />
 &emsp;&emsp;&emsp;return true; // handled<br />
 &emsp;&emsp;}<br />
 <br />
 &emsp;default:<br />
 &emsp;&emsp;return false; // not handled<br />
 &emsp;}<br />
 <br />
 &emsp;return false;<br />
 }<br />
 <br />
 Now, we can remove the cooking calculation from the frame processing function (we’ll just comment it out):<br />
 <br />
 // &mdash; convert dB to raw NOW DONE IN postUpdatePluginParameter<br />
 // &mdash; double volumeCooked = pow(10.0, volume_dB / 20.0);<br />
 <b>double volume_L = volumeCooked;</b><br />
 <b>double volume_R = volumeCooked;</b><br />
 etc…<br />
 <br />
 <b>Parameter Smoothing ON</b><br />
 When parameter smoothing or VST3 sample accurate automation is enabled, the value of the <em>volume_dB</em> variable is going to be smoothed and updated on each sample interval at the top of the <em>processAudioFrame</em> function. However, both the normal parameter smoothing and VST3 sample accurate updating methods will call our <em>postUpdatePluginParameter</em> function after the smoothing operation has occurred. With our cooking code in <em>postUpdatePluginParameter</em>, there is nothing else to do! The <em>volume_dB</em> value will be smoothed and updated at the top of each frame processing cycle and we will recalculate our cooked value afterwards. The VST3 sample accurate update process overrides the ordinary parameter smoothing so that the parameter is not smoothed or updated twice, therefore you don’t need to worry about your cooking code being called unnecessarily.<br />
 <br />
 There may be situations where you do not want to perform the post-update cooking function based on whether the parameter was changed during 1) the normal buffer cycle process, 2) a parameter smoothing operation, 3) a VST sample accurate update or 4) the user loading a preset. You might want to experiment with CPU usage rates or have other plugin-specific issues to deal with. For example, if the cooking process is CPU intensive because of some plugin option that the user has chosen, you might opt to disable the cooking in this situation. The third argument in the postUpdatePluginParameter function is a <a class="el" href="struct_parameter_update_info.html" title="Information about a paraemeter being updated. Used when bound variables are updated. Multiple advanced uses. ">ParameterUpdateInfo</a> structure that delivers information about how and why the function is being called. You can examine the member variables and use them to alter your logic for the cooking process.<br />
 <br />
 <b>struct <a class="el" href="struct_parameter_update_info.html" title="Information about a paraemeter being updated. Used when bound variables are updated. Multiple advanced uses. ">ParameterUpdateInfo</a></b> {<br />
 &emsp;&lt;SNIP snip="" snip&gt;=""&gt;<br />
</p>
<p>&emsp;<b>bool isSmoothing;</b><br />
 &emsp;<b>bool isVSTSampleAccurateUpdate;</b><br />
 &emsp;<b>bool loadingPreset;</b><br />
 &emsp;<b>bool boundVariableUpdate;</b><br />
 &emsp;<b>bool bufferProcUpdate;</b><br />
 <br />
 &emsp;&lt;SNIP snip="" snip&gt;=""&gt;<br />
 };<br />
 <br />
 These boolean flags are fairly straightforward to figure out by their names, but here the logic used.<br />
 <br />
 <b>isSmoothing:</b> ordinary parameter smoothing<br />
 <b>isVST3SampleAccurateUpdate:</b> a VST3 sample accurate automation update<br />
 <b>loadingPreset:</b> the user loaded a preset in the host DAW<br />
 <b>boundVariableUpdate:</b> the variable binding operation has occurred<br />
 <b>bufferProcUpdate:</b> updating at the top of the buffer process cycle<br />
 </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="index.html">ASPiK Developer&#39;s Guide</a></li><li class="navelem"><a class="el" href="simple_plugin.html">Write a Plugin</a></li><li class="navelem"><a class="el" href="define_plugin8.html">Processing the Audio Data</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.14 </li>
  </ul>
</div>
</body>
</html>
